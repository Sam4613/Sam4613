<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>AR App</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>
  <body>
    <a-scene embedded arjs>
      <a-marker preset="hiro">
        <a-box position="0 0.5 0" material="color: red;"></a-box>
      </a-marker>
      
      <a-entity camera>
        <a-entity cursor="fuse: true; fuseTimeout: 500" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03;" material="color: white; shader: flat">
          <a-animation begin="click" easing="ease-in" attribute="scale" fill="backwards" from="0.1 0.1 0.1" to="1 1 1" dur="150"></a-animation>
          <a-animation begin="cursor-fusing" easing="ease-in" attribute="scale" fill="forwards" from="1 1 1" to="0.1 0.1 0.1" dur="500"></a-animation>
        </a-entity>
      </a-entity>
      
      <a-assets>
        <a-asset-item id="tree" src="path/to/tree.glb"></a-asset-item>
      </a-assets>
      
      <script>
        AFRAME.registerComponent('rotate-on-tick', {
          tick: function (time, timeDelta) {
            this.el.object3D.rotation.y += timeDelta / 1000 * this.data.speed;
          }
        });
        
        AFRAME.registerComponent('show-at-distance', {
          schema: {
            distance: { type: 'number', default: 2 }
          },
          init: function () {
            var camera = document.querySelector('[camera]');
            var distance = this.data.distance;
            this.el.setAttribute('visible', false);
            this.el.addEventListener('loaded', function () {
              var model = this.getObject3D('mesh');
              var bbox = new THREE.Box3().setFromObject(model);
              var size = new THREE.Vector3();
              bbox.getSize(size);
              var distanceToBox = (size.z / 2) + distance;
              this.setAttribute('position', '0 0 -' + distanceToBox);
              this.setAttribute('visible', true);
            });
          }
        });
        
        AFRAME.registerComponent('look-at-camera', {
          tick: function () {
            this.el.object3D.lookAt(this.el.sceneEl.camera.getWorldPosition());
          }
        });
        
        var scene = document.querySelector('a-scene');
        scene.addEventListener('loaded', function () {
          if (navigator.geolocation) {
            navigator.geolocation.watchPosition(function (position) {
              var altitude = position.coords.altitude || 0;
              var camera = document.querySelector('[camera]');
              camera.setAttribute('gps-camera', 'latitude: ' + position.coords.latitude + '; longitude: ' + position.coords.longitude + '; altitude: ' + altitude + ';');
            });
          }
        });
        
        var tree = document.createElement('a-entity');
        tree.setAttribute('gltf-model', '#tree-model');
tree.setAttribute('scale', '0.05 0.05 0.05');
tree.setAttribute('position', {
x: getRandomPosition(-50, 50),
y: 0,
z: getRandomPosition(-50, 50)
});
scene.appendChild(tree);
}
  // Update the position of the assets based on the user's location
  function updateAssetPositions(userPosition) {
    // Loop through all the assets
    for (var i = 0; i < assets.length; i++) {
      var asset = assets[i];
      // Calculate the distance between the user and the asset
      var distance = getDistance(userPosition, asset.getAttribute('position'));

      // If the asset is within the visible distance range, set its visibility to true
      if (distance <= visibleDistance) {
        asset.setAttribute('visible', true);
      }
      // Otherwise, set its visibility to false
      else {
        asset.setAttribute('visible', false);
      }

      // Calculate the angle between the user and the asset
      var angle = getAngle(userPosition, asset.getAttribute('position'));

      // Set the rotation of the asset to face the user
      asset.setAttribute('rotation', {
        x: 0,
        y: -angle,
        z: 0
      });
    }
  }

  // Get a random position within a range
  function getRandomPosition(min, max) {
    return Math.random() * (max - min) + min;
  }

  // Get the distance between two positions
  function getDistance(position1, position2) {
    var dx = position1.x - position2.x;
    var dy = position1.y - position2.y;
    var dz = position1.z - position2.z;
    return Math.sqrt(dx * dx + dy * dy + dz * dz);
  }

  // Get the angle between two positions
  function getAngle(position1, position2) {
    var dx = position2.x - position1.x;
    var dz = position2.z - position1.z;
    return (Math.atan2(dz, dx) * 180 / Math.PI) - 90;
  }

  // Call the setup function when the scene is loaded
  scene.addEventListener('loaded', setup);
</script>
  </body>
</html>
