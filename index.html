<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js/aframe/build/aframe-ar.js"></script>
  </head>
  <body>
    <a-scene embedded arjs="debugUIEnabled:false;">
      <a-entity gps-camera rotation-reader></a-entity>
      <a-box position="0 0.5 0" material="color: red;"></a-box>
      <a-entity gltf-model="url(https://cdn.aframe.io/models/animated-figures/female.glb)" position="0 0 -2" scale="0.1 0.1 0.1" gps-entity-place="latitude: 51.5074; longitude: 0.1278;"></a-entity>
      <a-entity gltf-model="url(https://cdn.aframe.io/models/animated-figures/male.glb)" position="0 0 -1" scale="0.1 0.1 0.1" gps-entity-place="latitude: 51.5074; longitude: 0.1278;"></a-entity>
      <script>
        AFRAME.registerComponent('gps-entity-place', {
          init: function () {
            var entity = this.el;
            this.data.position = { x: 0, y: 0, z: 0 };
            navigator.geolocation.getCurrentPosition(function (position) {
              entity.setAttribute('gps-projected-entity-place', {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude
              });
            });
          }
        });

        AFRAME.registerComponent('gps-projected-entity-place', {
          schema: {
            latitude: { type: 'number' },
            longitude: { type: 'number' }
          },

          init: function () {
            var loader = new THREE.GLTFLoader();
            var entity = this.el;
            var position = this.data.position;
            var location = new THREE.Vector3();
            location.x = position.x;
            location.y = position.y;
            location.z = position.z;
            entity.setAttribute('position', location);
            loader.load(entity.getAttribute('gltf-model'), function (gltf) {
              var model = gltf.scene;
              model.position.set(location.x, location.y, location.z);
              model.scale.set(entity.getAttribute('scale').x, entity.getAttribute('scale').y, entity.getAttribute('scale').z);
              entity.setObject3D('mesh', model);
            });
          }
        });
      </script>
    </a-scene>
  </body>
</html>
